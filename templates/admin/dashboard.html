<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Cafetería Las Dos Amigas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    * { font-family: 'Poppins', sans-serif; }
    .modal { display: none; position: fixed; z-index: 1000; inset: 0; background: rgba(0,0,0,0.5); }
    .modal.show { display: flex; align-items: center; justify-content: center; }
  </style>
</head>
<body class="bg-amber-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-lg sticky top-0 z-40">
    <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fas fa-coffee text-amber-600 text-2xl"></i>
        <h1 class="text-2xl font-bold text-amber-800">Cafetería Las Dos Amigas</h1>
        
      </div>
       <span class="text-amber-800">Bienvenido, {{ nombre_admin }}</span>
      <a href="{{ url_for('auth_routes.logout') }}" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700">
        <i class="fas fa-home mr-2"></i> Cerrar sesión
      </a>
    </nav>
  </header>

  <main class="container mx-auto px-4 py-8">

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6">
          {% for category, message in messages %}
            <div class="p-3 rounded mb-2
              {% if category == 'success' %} bg-green-100 text-green-700
              {% elif category == 'error' %} bg-red-100 text-red-700
              {% else %} bg-amber-100 text-amber-700 {% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white p-6 rounded-xl shadow-lg">
        <p class="text-amber-600 text-sm">Total Productos</p>
        <p class="text-3xl font-bold text-amber-800">{{ productos|length }}</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg">
        <p class="text-amber-600 text-sm">Empleados</p>
        <p class="text-3xl font-bold text-amber-800">{{ usuarios|length }}</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg">
        <p class="text-amber-600 text-sm">Ventas Hoy</p>
        <p class="text-3xl font-bold text-amber-800">$1,250</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg">
        <p class="text-amber-600 text-sm">Pedidos</p>
        <p class="text-3xl font-bold text-amber-800">45</p>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
      <button onclick="openModal('productModal')" class="bg-amber-600 hover:bg-amber-700 text-white p-6 rounded-xl shadow-lg">
        <i class="fas fa-plus-circle text-3xl mb-2"></i>
        <h3 class="text-xl font-bold">Agregar Producto</h3>
      </button>
      <button onclick="openModal('employeeModal')" class="bg-amber-600 hover:bg-amber-700 text-white p-6 rounded-xl shadow-lg">
        <i class="fas fa-user-plus text-3xl mb-2"></i>
        <h3 class="text-xl font-bold">Agregar Empleado</h3>
      </button>
    </div>

    <!-- Productos -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h3 class="text-xl font-bold text-amber-800 mb-4">Productos</h3>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for p in productos %}
        <div class="border rounded-lg p-4">
          <img src="{{ p.imagen_url or '/static/img/default.png' }}" class="w-full h-40 object-cover rounded mb-3">
          <h4 class="font-bold text-amber-800">{{ p.nombre }}</h4>
          <p class="text-sm text-amber-700">{{ p.descripcion }}</p>
          <p class="text-lg font-bold text-amber-600">${{ "%.2f"|format(p.precio) }}</p>

          <div class="flex space-x-2 mt-3">
            <!-- Editar -->
            <button onclick="openModal('editProduct{{ p.id }}')" class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-1 rounded">Editar</button>

            <!-- Eliminar -->
            <form action="{{ url_for('admin_routes.eliminar_producto', id=p.id) }}" method="POST">
              <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">Eliminar</button>
            </form>
          </div>
        </div>

        <!-- Modal Editar Producto -->
        <div id="editProduct{{ p.id }}" class="modal">
          <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <h3 class="text-xl font-bold text-amber-800 mb-4">Editar Producto</h3>
            <form action="{{ url_for('admin_routes.editar_producto', id=p.id) }}" method="POST" enctype="multipart/form-data">
              <input type="text" name="nombre" value="{{ p.nombre }}" class="w-full border p-2 mb-3">
              <input type="number" step="0.01" name="precio" value="{{ p.precio }}" class="w-full border p-2 mb-3">
              <textarea name="descripcion" class="w-full border p-2 mb-3">{{ p.descripcion }}</textarea>
              <input type="file" name="imagen" class="mb-3">
              <button type="submit" class="w-full bg-amber-600 text-white py-2 rounded">Guardar Cambios</button>
            </form>
            <button onclick="closeModal('editProduct{{ p.id }}')" class="mt-2 text-red-600">Cerrar</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Empleados -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h3 class="text-xl font-bold text-amber-800 mb-4">Empleados</h3>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for e in usuarios %}
        {% if e.rol == 'empleado' %}
        <div class="border rounded-lg p-4">
          <h4 class="font-bold text-amber-800">{{ e.nombre_completo }}</h4>
          <p class="text-sm text-amber-700">{{ e.correo }}</p>
          <div class="flex space-x-2 mt-3">
            <!-- Editar -->
            <button onclick="openModal('editEmpleado{{ e.id }}')" class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-1 rounded">Editar</button>

            <!-- Eliminar -->
            <form action="{{ url_for('admin_routes.eliminar_empleado', id=e.id) }}" method="POST">
              <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">Eliminar</button>
            </form>
          </div>
        </div>

        <!-- Modal Editar Empleado -->
        <div id="editEmpleado{{ e.id }}" class="modal">
          <div class="bg-white rounded-xl p-6 max-w-md w-full">
            <h3 class="text-xl font-bold text-amber-800 mb-4">Editar Empleado</h3>
            <form action="{{ url_for('admin_routes.editar_empleado', id=e.id) }}" method="POST">
              <input type="text" name="nombre_completo" value="{{ e.nombre_completo }}" class="w-full border p-2 mb-3">
              <input type="email" name="correo" value="{{ e.correo }}" class="w-full border p-2 mb-3">
              <button type="submit" class="w-full bg-amber-600 text-white py-2 rounded">Guardar Cambios</button>
            </form>
            <button onclick="closeModal('editEmpleado{{ e.id }}')" class="mt-2 text-red-600">Cerrar</button>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Actividad Reciente -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-bold text-amber-800 mb-4">Actividad Reciente</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="font-semibold text-amber-700 mb-2">Últimos Productos</h4>
          {% for p in ultimos_productos %}
            <p class="text-sm text-amber-800">➤ {{ p.nombre }} agregado</p>
          {% endfor %}
        </div>
        <div>
          <h4 class="font-semibold text-amber-700 mb-2">Últimos Empleados</h4>
          {% for e in ultimos_empleados %}
            <p class="text-sm text-amber-800">➤ {{ e.nombre_completo }} agregado</p>
          {% endfor %}
        </div>
      </div>
    </div>

  </main>

  <!-- Modal Agregar Producto -->
  <div id="productModal" class="modal">
    <div class="bg-white rounded-xl p-6 max-w-md w-full">
      <h3 class="text-xl font-bold text-amber-800 mb-4">Agregar Producto</h3>
      <form action="{{ url_for('admin_routes.anadir_producto') }}" method="POST" enctype="multipart/form-data">
        <input type="text" name="nombre" placeholder="Nombre" class="w-full border p-2 mb-3" required>
        <input type="number" step="0.01" name="precio" placeholder="Precio" class="w-full border p-2 mb-3" required>
        <select name="categorias_id" class="w-full border p-2 mb-3" required>
          <option value="">Seleccionar categoría</option>
          {% for c in categorias %}
          <option value="{{ c.id }}">{{ c.nombre }}</option>
          {% endfor %}
        </select>
        <textarea name="descripcion" placeholder="Descripción" class="w-full border p-2 mb-3"></textarea>
        <input type="file" name="imagen" class="mb-3">
        <input type="hidden" name="es_rotativo" value="0">
        <button type="submit" class="w-full bg-amber-600 text-white py-2 rounded">Agregar</button>
      </form>
      <button onclick="closeModal('productModal')" class="mt-2 text-red-600">Cerrar</button>
    </div>
  </div>

  <!-- Modal Agregar Empleado -->
  <div id="employeeModal" class="modal">
    <div class="bg-white rounded-xl p-6 max-w-md w-full">
      <h3 class="text-xl font-bold text-amber-800 mb-4">Agregar Empleado</h3>
      <form action="{{ url_for('admin_routes.add_empleado') }}" method="POST">
        <input type="text" name="nombre_completo" placeholder="Nombre Completo" class="w-full border p-2 mb-3" required>
        <input type="email" name="correo" placeholder="Correo" class="w-full border p-2 mb-3" required>
        <button type="submit" class="w-full bg-amber-600 text-white py-2 rounded">Agregar</button>
      </form>
      <button onclick="closeModal('employeeModal')" class="mt-2 text-red-600">Cerrar</button>
    </div>
  </div>

  <script>
    function openModal(id) { document.getElementById(id).classList.add("show"); }
    function closeModal(id) { document.getElementById(id).classList.remove("show"); }
    window.onclick = function(e) {
      if (e.target.classList.contains('modal')) { e.target.classList.remove('show'); }
    }
  </script>
</body>
</html>
